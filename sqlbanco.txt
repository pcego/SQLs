CREATE DATABASE controleestoque;
use controleestoque

CREATE TABLE clientes (
 cod int identity(1,1),
 nome varchar(60) not null,
 primary key (cod)
 )

CREATE INDEX ixnome ON clientes (nome)

CREATE TABLE produtos(
 cod int identity(1,1),
 descricao varchar(255) not null,
 estoque int not null,
 primary key (cod)
)

CREATE INDEX ixprodutos ON produtos (descricao);

CREATE TABLE fornecedores(
 cod int identity(1,1),
 nome varchar(60) not null,
 cnpj varchar(18) not null unique,
 primary key (cod)
 )

CREATE INDEX ixnome ON fornecedores (nome);


CREATE TABLE compra (
 cod int identity(1,1),
 fornecedor int not null,
 data date,
 primary key (cod),
 foreign key (fornecedor) references fornecedores (cod)
) 
 
CREATE INDEX ixdata ON compra (data)

CREATE TABLE vendas (
 cod int identity(1,1),
 cliente int not null,
 data date,
 primary key (cod)
)

CREATE INDEX ixdata ON vendas (data)


faltando algumas coisas....
 
 lista data / produto / quantidade venda / quantidade compra
 
from produtos p join ((select data, produtos from itensVendas iv join vendas v ON iv.vendas=v.codigo)
					UNION
					  (select data, produtos from ItensCompra ic join compra c ON ic.compra = c.codigo) ) as
					  ON Datas produto = p.codigo
					  
					  select DATEPART(m,Datas.data) as Mes, p.descricao as Produto,
					  ( select SUM (quantidade) from ItensVendas iv join venda v ON iv.venda = v.codigo
						where v.produto = p.codigo and DATEPART (m,v.data) = DATEPART (m,Datas.data) ) as QtdVendas, 
						( select SUM (quantidade) from ItensVendas ic join Compras c ON ic.compra = c.codigo
							where c.produto = p.codigo and DATEPART (m, c.data) = DATEPART (m, Datas.data) ) as QtdCompras
							
							

teste kennedi 